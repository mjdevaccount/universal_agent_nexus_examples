name: n-decision-router
version: "1.0.0"
description: |
  Router-driven agent that can take N decision paths. Demonstrates reusable routing
  definitions plus dynamic tool injection.

graphs:
  - name: main
    entry_node: analyze_query
    nodes:
      - id: analyze_query
        kind: router
        label: Decision Router
        config:
          llm: "local://qwen2.5-32b"
          system_message: |
            You are the routing coordinator. Classify the user's request into one of:
            - data_quality (detect anomalies or missing data)
            - growth_experiment (A/B testing and experiment design)
            - customer_support (triage and response playbooks)
            - reporting (dashboards and KPI summaries)

            Respond with only the category name.

      - id: data_quality_exec
        kind: tool
        tool_ref: data_quality_tool
        label: Execute Data Quality

      - id: growth_experiment_exec
        kind: tool
        tool_ref: growth_experiment_tool
        label: Execute Growth Experiment

      - id: customer_support_exec
        kind: tool
        tool_ref: customer_support_tool
        label: Execute Customer Support

      - id: reporting_exec
        kind: tool
        tool_ref: reporting_tool
        label: Execute Reporting

      - id: format_response
        kind: task
        label: Format Response
        config:
          prompt: |
            Summarize the tool output clearly for the user:
            {result}

    edges:
      - from_node: analyze_query
        to_node: data_quality_exec
        condition:
          expression: "contains(output, 'data_quality')"

      - from_node: analyze_query
        to_node: growth_experiment_exec
        condition:
          expression: "contains(output, 'growth_experiment')"

      - from_node: analyze_query
        to_node: customer_support_exec
        condition:
          expression: "contains(output, 'customer_support')"

      - from_node: analyze_query
        to_node: reporting_exec
        condition:
          expression: "contains(output, 'reporting')"

      - from_node: data_quality_exec
        to_node: format_response

      - from_node: growth_experiment_exec
        to_node: format_response

      - from_node: customer_support_exec
        to_node: format_response

      - from_node: reporting_exec
        to_node: format_response

tools:
  - name: data_quality_tool
    protocol: mcp
    config:
      command: mcp-data-quality
      args: ["--mode", "anomaly"]

  - name: growth_experiment_tool
    protocol: mcp
    config:
      command: mcp-growth-experiments
      args: ["--llm", "local://qwen2.5-32b"]

  - name: customer_support_tool
    protocol: mcp
    config:
      command: mcp-support
      args: ["--kb", "/data/kb.sqlite"]

  - name: reporting_tool
    protocol: mcp
    config:
      command: mcp-reporting
      args: ["--metrics", "weekly"]
