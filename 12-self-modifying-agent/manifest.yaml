name: self-modifying-agent
version: 2.0.0
description: Decision router with tool branches using v3.0.1 patterns
graphs:
- name: main
  entry_node: analyze_query
  nodes:
  - id: analyze_query
    kind: router
    label: Decision Router
    router_ref: decision_router
  - id: search_docs_exec
    kind: tool
    label: Search Documents
    description: null
    config: {}
    source_location: null
    metadata:
      data: {}
      _annotations: {}
    router_ref: null
    tool_ref: doc_search
  - id: calculate_risk_exec
    kind: tool
    label: Calculate Risk
    description: null
    config: {}
    source_location: null
    metadata:
      data: {}
      _annotations: {}
    router_ref: null
    tool_ref: risk_calculator
  - id: format_response
    kind: router
    label: Format Response
    router_ref: formatter_router
  edges:
  - from_node: analyze_query
    to_node: search_docs_exec
    condition:
      route: "search_docs"
  - from_node: search_docs_exec
    to_node: format_response
  - from_node: analyze_query
    to_node: calculate_risk_exec
    condition:
      route: "calculate_risk"
  - from_node: calculate_risk_exec
    to_node: format_response
  metadata:
    data: {}
    _annotations: {}
tools:
- name: doc_search
  description: Search indexed documents for answers.
  protocol: mcp
  config:
    command: mcp-doc-search
  input_schema: null
  output_schema: null
  metadata:
    data: {}
    _annotations: {}
- name: risk_calculator
  description: Compute risk scores for a portfolio or request.
  protocol: mcp
  config:
    command: mcp-risk-calc
  input_schema: null
  output_schema: null
  metadata:
    data: {}
    _annotations: {}
routers:
  - name: decision_router
    strategy: llm
    system_message: |
      Decide whether to search documents or calculate risk.
      Respond with ONE word: "search_docs" or "calculate_risk"
    default_model: "ollama://qwen3:8b"
  - name: formatter_router
    strategy: llm
    system_message: |
      Format the tool result for the user in a clear, concise way.
      Make it actionable and easy to understand.
    default_model: "ollama://qwen3:8b"
policies: []
metadata:
  data: {}
  _annotations: {}
