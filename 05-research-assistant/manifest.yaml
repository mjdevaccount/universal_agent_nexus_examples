name: research-assistant
version: "2.0.0"
description: "Document analysis and multi-document synthesis assistant with LLM-powered extraction"

graphs:
  - name: analyze_document
    entry_node: parse_document
    nodes:
      - id: parse_document
        kind: tool
        label: "Parse Document"
        tool_ref: document_parser
      
      - id: chunk_content
        kind: task
        label: "Chunk Content"
        config:
          chunk_size: 1000
          overlap: 200
          strategy: "semantic"
      
      - id: extract_key_points
        kind: router
        label: "Extract Key Points"
        router_ref: key_points_router
      
      - id: extract_entities
        kind: router
        label: "Entity Extraction"
        router_ref: entity_router
      
      - id: identify_themes
        kind: router
        label: "Theme Analysis"
        router_ref: theme_router
      
      - id: generate_summary
        kind: router
        label: "Generate Summary"
        router_ref: summary_router
    
    edges:
      - from_node: parse_document
        to_node: chunk_content
        condition:
          trigger: success
      
      - from_node: chunk_content
        to_node: extract_key_points
        condition:
          trigger: success
      
      - from_node: chunk_content
        to_node: extract_entities
        condition:
          trigger: success
      
      - from_node: extract_key_points
        to_node: identify_themes
        condition:
          trigger: success
      
      - from_node: identify_themes
        to_node: generate_summary
        condition:
          trigger: success
      
      - from_node: extract_entities
        to_node: generate_summary
        condition:
          trigger: success

  - name: synthesize_documents
    entry_node: collect_summaries
    nodes:
      - id: collect_summaries
        kind: task
        label: "Collect Document Summaries"
        config:
          action: "aggregate"
          source: "analyze_document.results"
      
      - id: compare_findings
        kind: router
        label: "Compare Findings"
        router_ref: comparison_router
      
      - id: synthesize
        kind: router
        label: "Generate Synthesis"
        router_ref: synthesis_router
    
    edges:
      - from_node: collect_summaries
        to_node: compare_findings
        condition:
          trigger: success
      
      - from_node: compare_findings
        to_node: synthesize
        condition:
          trigger: success

tools:
  - name: document_parser
    description: "Parse various document formats into text"
    protocol: "python"
    config:
      module: "parsers.document"
      function: "parse"
      supported_formats:
        - pdf
        - docx
        - txt
        - md
        - html
    input_schema:
      type: object
      properties:
        file_path:
          type: string
        format:
          type: string
    output_schema:
      type: object
      properties:
        text:
          type: string
        metadata:
          type: object
        pages:
          type: integer

routers:
  - name: key_points_router
    strategy: llm
    system_message: |
      You are a research analysis assistant. Extract key points from document sections.
      
      For each key point, provide:
      - Claim: The main assertion
      - Evidence: Supporting details
      - Confidence: high/medium/low
      - Page/Section: Location in document
      
      Format as structured JSON array of key points.
    default_model: "ollama://qwen3:8b"
  
  - name: entity_router
    strategy: llm
    system_message: |
      You are an entity extraction assistant. Extract named entities from text.
      
      Categories: people, organizations, locations, technologies, dates, citations
      
      Return JSON array with entities grouped by category.
    default_model: "ollama://qwen3:8b"
  
  - name: theme_router
    strategy: llm
    system_message: |
      You are a theme analysis assistant. Identify main themes in documents.
      
      For each theme, provide:
      - Name and description
      - Supporting evidence
      - Relevance score (1-10)
      
      Return JSON array of themes.
    default_model: "ollama://qwen3:8b"
  
  - name: summary_router
    strategy: llm
    system_message: |
      You are a research summarization assistant. Generate a comprehensive summary based on the analysis results.
      
      Review the conversation history to find:
      - Key points extracted from the document
      - Entities mentioned
      - Themes identified
      
      Structure your summary:
      1. Executive Summary (2-3 sentences)
      2. Main Arguments
      3. Key Findings
      4. Implications
      
      Create a well-formatted, coherent summary that synthesizes all the analysis results.
    default_model: "ollama://qwen3:8b"
  
  - name: comparison_router
    strategy: llm
    system_message: |
      You are a research comparison assistant. Compare findings across multiple documents.
      
      Identify:
      1. Common themes and agreements
      2. Contrasting views and disagreements
      3. Unique contributions from each document
      4. Gaps in the collective knowledge
      
      Format as structured analysis with clear sections.
    default_model: "ollama://qwen3:8b"
  
  - name: synthesis_router
    strategy: llm
    system_message: |
      You are a research synthesis assistant. Create comprehensive synthesis documents.
      
      Structure:
      1. Overview
      2. Key Themes (with citations)
      3. Areas of Agreement
      4. Areas of Debate
      5. Recommendations
      6. Bibliography
      
      Create a well-formatted, academic-quality synthesis.
    default_model: "ollama://qwen3:8b"

policies: []

